<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Keykicks â€“ Online Shop</title>

<style>
/* ================== RESET ================== */
*{box-sizing:border-box;margin:0;padding:0;font-family:Arial,Helvetica,sans-serif}
body{background:#0f0f0f;color:#fff}
a{color:inherit;text-decoration:none}
button{cursor:pointer}

/* ================== HEADER ================== */
header{display:flex;justify-content:space-between;align-items:center;padding:20px;background:#000;position:sticky;top:0;z-index:10}
header h1{font-size:24px}
.search-bar input{padding:8px;border-radius:6px;border:none}

/* ================== LAYOUT ================== */
main{padding:30px;max-width:1200px;margin:auto}
.section-title{font-size:22px;margin-bottom:15px}

.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:20px}
.card{background:#1a1a1a;border-radius:12px;padding:15px;display:flex;flex-direction:column}
.card img{width:100%;border-radius:8px;margin-bottom:10px}
.card h3{font-size:18px;margin-bottom:5px}
.card p{font-size:14px;opacity:.8;margin-bottom:10px}
.card button{margin-top:auto;padding:10px;border:none;border-radius:8px;background:#ff5a00;color:#fff;font-weight:bold}

/* ================== CART ================== */
#cartBtn{position:fixed;right:20px;bottom:20px;background:#ff5a00;border:none;color:#fff;padding:15px;border-radius:50%;font-size:18px}

#cartOverlay{position:fixed;inset:0;background:rgba(0,0,0,.7);display:none;justify-content:center;align-items:center}
#cart{background:#111;padding:20px;border-radius:12px;width:90%;max-width:420px}
#cart h2{margin-bottom:10px}
.cart-item{display:flex;justify-content:space-between;margin:8px 0}

/* ================== CHECKOUT ================== */
input,select{width:100%;padding:10px;margin:6px 0;border-radius:6px;border:none}
.checkout-btn{background:#00c853;border:none;padding:12px;border-radius:8px;width:100%;font-weight:bold;margin-top:10px}

#checkout-response{margin-top:10px;text-align:center}

/* ================== FOOTER ================== */
footer{text-align:center;padding:20px;opacity:.6}
</style>
</head>
<body>

<header>
  <h1>Keykicks</h1>
  <form class="search-bar" id="searchForm">
    <input type="text" id="searchInput" placeholder="Searchâ€¦">
  </form>
</header>

<main>
  <h2 class="section-title">Produkte</h2>
  <div class="grid" id="productGrid"></div>
</main>

<button id="cartBtn">ðŸ›’</button>

<div id="cartOverlay">
  <div id="cart">
    <h2>Warenkorb</h2>
    <div id="cartItems"></div>
    <p><strong>Gesamt:</strong> <span id="cartTotal">â‚¬0,00</span></p>

    <h3>Checkout</h3>
    <input id="firstName" placeholder="Vorname">
    <input id="lastName" placeholder="Nachname">
    <input id="email" placeholder="E-Mail">
    <select id="payment">
      <option value="paypal">PayPal</option>
      <option value="card">Kreditkarte</option>
    </select>
    <button class="checkout-btn" id="complete-order-btn">Jetzt kaufen</button>
    <div id="checkout-response"></div>
  </div>
</div>

<footer>Â© Keykicks</footer>

<script>
/* ================== CONFIG ================== */
const PRODUCTS_URL = 'https://raw.githubusercontent.com/pfundbo81/website-keykicks/main/products.json';
const API_URL = 'https://website-keykicks.vercel.app/api/create-order';

let products=[];
let cart=[];

/* ================== HELPERS ================== */
const â‚¬ = v=>'â‚¬'+v.toFixed(2).replace('.',',');
const price = p=>parseFloat(String(p).replace('â‚¬','').replace(',','.'))||0;

/* ================== PRODUCTS ================== */
async function loadProducts(){
 const res=await fetch(PRODUCTS_URL,{cache:'no-store'});
 const data=await res.json();
 products=[...data.sneaker,...data.comic,...data.other].map((p,i)=>({...p,id:i,price:price(p.price)}));
 renderProducts(products);
}

function renderProducts(list){
 const grid=document.getElementById('productGrid');
 grid.innerHTML='';
 list.forEach(p=>{
  const c=document.createElement('div');c.className='card';
  c.innerHTML=`<img src="${p.image||''}"><h3>${p.name}</h3><p>${â‚¬(p.price)}</p><button>Kaufen</button>`;
  c.querySelector('button').onclick=()=>addToCart(p);
  grid.appendChild(c);
 });
}

/* ================== SEARCH ================== */
document.getElementById('searchForm').onsubmit=e=>e.preventDefault();
document.getElementById('searchInput').oninput=e=>{
 const q=e.target.value.toLowerCase();
 renderProducts(products.filter(p=>p.name.toLowerCase().includes(q)));
};

/* ================== CART ================== */
function addToCart(p){
 const item=cart.find(i=>i.id===p.id);
 if(item) item.qty++; else cart.push({...p,qty:1});
 renderCart();
}

function renderCart(){
 const el=document.getElementById('cartItems');
 el.innerHTML='';
 let total=0;
 cart.forEach(i=>{
  total+=i.price*i.qty;
  const d=document.createElement('div');d.className='cart-item';
  d.innerHTML=`<span>${i.name} Ã— ${i.qty}</span><span>${â‚¬(i.price*i.qty)}</span>`;
  el.appendChild(d);
 });
 document.getElementById('cartTotal').textContent=â‚¬(total);
}

/* ================== OVERLAY ================== */
const overlay=document.getElementById('cartOverlay');
document.getElementById('cartBtn').onclick=()=>overlay.style.display='flex';
overlay.onclick=e=>{if(e.target===overlay)overlay.style.display='none'};

/* ================== CHECKOUT ================== */
document.getElementById('complete-order-btn').onclick=async()=>{
 if(cart.length===0) return;
 const payload={
  customer_name:document.getElementById('firstName').value+' '+document.getElementById('lastName').value,
  customer_email:document.getElementById('email').value,
  items:cart,
  total:cart.reduce((s,i)=>s+i.price*i.qty,0),
  payment:document.getElementById('payment').value
 };

 const resEl=document.getElementById('checkout-response');
 resEl.textContent='Sende Bestellungâ€¦';

 try{
  const r=await fetch(API_URL,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});
  const d=await r.json();
  if(!r.ok||!d.success) throw new Error(d.error||'Fehler');
  resEl.textContent='Bestellung erfolgreich! ID: '+d.orderId;
  cart=[];renderCart();
 }catch(err){resEl.textContent='Fehler: '+err.message}
};

loadProducts();
</script>
</body>
</html>
