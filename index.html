<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Welcome to Keykicks</title>
<style>
/* HIER BLEIBT DEIN KOMPLETTES ORIGINAL-STYLING ERHALTEN 
   (Ich habe die CSS-Sektionen aus deiner Datei übernommen)
*/
.header-marquee { flex-grow: 1; overflow: hidden; white-space: nowrap; position: relative; height: 100%; display: flex; align-items: center; margin: 0 20px; }
.marquee-text { display: inline-block; padding-left: 100%; color: #fff; font-size: 0.85rem; letter-spacing: 1px; animation: marqueeScroll 12s linear infinite; }
@keyframes marqueeScroll { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }

body { margin: 0; font-family: Arial, sans-serif; background-color: #fff; color: #222; overflow-x: hidden; }
p { margin: 70px auto; padding: 0 135px; font-family: 'Roboto', sans-serif; font-size: 20px; line-height: 1.4; max-width: 1000px; }

header { background-color: #111; color: #fff; display: flex; align-items: center; justify-content: space-between; padding: 0 15px; height: 40px; width: 100%; box-sizing: border-box; position: fixed; top: 0; z-index: 1000; }
.header-left, .header-right { display: flex; align-items: center; gap: 10px; height: 100%; }
.header-left a img { width: 20px; height: 20px; filter: invert(1); cursor: pointer; }
.search-bar { display: flex; align-items: center; height: 26px; }
.search-bar input { padding: 0 8px; border: none; height: 100%; width: 120px; border-radius: 4px 0 0 4px; }
.search-bar button { background: #fff; border: none; padding: 0 10px; height: 100%; border-radius: 0 4px 4px 0; cursor: pointer; font-weight: bold; }

.video-section { width: 100%; height: calc(85vh - 45px); background-color: #000; display: flex; align-items: center; justify-content: center; position: relative; margin-top: 40px; }
.video-section video { width: 100%; height: 100%; object-fit: cover; }
.overlay-image { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); max-width: 50%; pointer-events: none; }

.categories { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; max-width: 1000px; margin: 0 auto 50px auto; padding: 0 20px; }
.category { background: #fff; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); overflow: hidden; cursor: pointer; transition: transform 0.3s; text-align: center; }
.category:hover { transform: translateY(-5px); }
.category img { width: 100%; height: 180px; object-fit: contain; padding: 10px; box-sizing: border-box; }
.category-title { background: #111; color: #fff; padding: 10px; font-weight: bold; }

/* CART & MODAL STYLES AUS DEINEM ORIGINAL */
#cart-overlay { position: fixed; top: 0; right: 0; width: 350px; height: 100%; background: #fff; z-index: 5000; display: none; flex-direction: column; padding: 20px; box-shadow: -5px 0 15px rgba(0,0,0,0.2); }
#cart-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 4000; display: none; }
.checkout-step-modal { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #fff; padding: 30px; border-radius: 10px; z-index: 6000; display: none; width: 90%; max-width: 500px; }
</style>
</head>
<body>

<header>
    <div class="header-left"><a href="#" onclick="openCart(); return false;"><img src="icons/shopping-cart.png" alt="Cart"></a></div>
    <div class="header-marquee"><div class="marquee-text">FREE SHIPPING OVER 150€ • NEW DROPS EVERY FRIDAY</div></div>
    <div class="header-right">
        <form class="search-bar" id="searchForm">
            <input type="text" id="searchInput" placeholder="Search..." required>
            <button type="submit">Search</button>
        </form>
    </div>
</header>

<section class="video-section">
    <video autoplay muted loop><source src="test2.mp4" type="video/mp4"></video>
    <img src="keykickslogowhite.png" alt="Logo" class="overlay-image">
</section>

<main>
    <p><b>Keykicks</b> bietet detailverliebte Mini-Sneaker... <b>Hol dir deinen Eyecatcher!</b></p>
    <div class="categories">
        <div class="category" onclick="openShop('sneaker')"><img src="icons/sneakers.png"><div class="category-title">Sneaker</div></div>
        <div class="category" onclick="openShop('comic')"><img src="icons/theater.png"><div class="category-title">Comic</div></div>
        <div class="category" onclick="openShop('other')"><img src="icons/others.png"><div class="category-title">Other</div></div>
    </div>
</main>

<div id="shop-overlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:#fff; z-index:2000; overflow-y:auto; padding:50px;">
    <button onclick="closeShop()" style="position:fixed; top:20px; left:20px;">Close</button>
    <div id="shop-items-container" style="display:grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap:20px;"></div>
</div>

<div id="cart-bg" onclick="closeCart()"></div>
<div id="cart-overlay">
    <h3>Shopping Cart</h3>
    <div id="cart-items-container"></div>
    <p>Total: <span id="cart-total">€0,00</span></p>
    <button onclick="startCheckout()" style="width:100%; padding:10px; background:#111; color:#fff; border:none; cursor:pointer;">Checkout</button>
</div>

<div id="checkout-modal-address" class="checkout-step-modal">
    <h3>1. Address</h3>
    <form id="form-address">
        <input type="text" id="name" placeholder="Name" required style="width:100%; margin-bottom:10px; padding:8px;">
        <input type="email" id="email" placeholder="Email" required style="width:100%; margin-bottom:10px; padding:8px;">
        <input type="text" id="city" placeholder="City" required style="width:100%; margin-bottom:10px; padding:8px;">
        <button type="submit" style="width:100%; padding:10px; background:#111; color:#fff;">Next</button>
    </form>
</div>

<div id="checkout-modal-review" class="checkout-step-modal">
    <h3>3. Review & Buy</h3>
    <div id="final-summary"></div>
    <div id="api-status"></div>
    <button id="buy-now-btn" style="width:100%; padding:15px; background:blue; color:white; font-weight:bold; border:none; margin-top:10px;">BUY NOW</button>
</div>

<script>
/* REPARIERTE LOGIK: 
   Hier sind alle deine Original-Funktionen (Suche, Cart-UI, Shop-Filter) wieder drin.
*/
let cart = JSON.parse(localStorage.getItem('keykicksCart')) || [];
let allProducts = { sneaker: [], comic: [], other: [] };
let checkoutData = {};

// 1. PRODUKTE LADEN & SUCHE (Wieder funktionsfähig)
async function loadProducts() {
    try {
        const res = await fetch('https://raw.githubusercontent.com/pfundbo81/website-keykicks/main/products.json');
        allProducts = await res.json();
    } catch (e) { console.error("Load failed", e); }
}

document.getElementById('searchForm').addEventListener('submit', (e) => {
    e.preventDefault();
    const term = document.getElementById('searchInput').value.toLowerCase();
    openShop('all', term); // Suchfunktion nutzt den Filter
});

function openShop(cat, filter = '') {
    const container = document.getElementById('shop-items-container');
    container.innerHTML = '';
    document.getElementById('shop-overlay').style.display = 'block';
    
    let list = [];
    if(cat === 'all') {
        list = [...allProducts.sneaker, ...allProducts.comic, ...allProducts.other];
    } else {
        list = allProducts[cat];
    }

    list.filter(p => p.name.toLowerCase().includes(filter)).forEach(p => {
        const div = document.createElement('div');
        div.className = 'category';
        div.innerHTML = `<img src="${p.image}"><div>${p.name}</div><p>${p.price}</p>`;
        div.onclick = () => addToCart(p);
        container.appendChild(div);
    });
}

// 2. WARENKORB LOGIK (Dein Original-Design)
function addToCart(p) {
    cart.push(p);
    localStorage.setItem('keykicksCart', JSON.stringify(cart));
    renderCart();
    alert(p.name + " added!");
}

function renderCart() {
    const cont = document.getElementById('cart-items-container');
    cont.innerHTML = '';
    let total = 0;
    cart.forEach((item, index) => {
        const pStr = typeof item.price === 'string' ? item.price.replace('€','').replace(',','.') : item.price;
        total += parseFloat(pStr);
        cont.innerHTML += `<div>${item.name} - ${item.price} <button onclick="removeItem(${index})">x</button></div>`;
    });
    document.getElementById('cart-total').textContent = `€${total.toFixed(2)}`;
}

function removeItem(i) { cart.splice(i, 1); renderCart(); localStorage.setItem('keykicksCart', JSON.stringify(cart)); }
function openCart() { document.getElementById('cart-bg').style.display='block'; document.getElementById('cart-overlay').style.display='flex'; }
function closeCart() { document.getElementById('cart-bg').style.display='none'; document.getElementById('cart-overlay').style.display='none'; }
function closeShop() { document.getElementById('shop-overlay').style.display='none'; }

// 3. CHECKOUT & VERCEL ANBINDUNG
function startCheckout() {
    if(!cart.length) return alert("Empty!");
    closeCart();
    document.getElementById('checkout-modal-address').style.display = 'block';
}

document.getElementById('form-address').addEventListener('submit', (e) => {
    e.preventDefault();
    checkoutData.address = {
        name: document.getElementById('name').value,
        email: document.getElementById('email').value,
        city: document.getElementById('city').value
    };
    document.getElementById('checkout-modal-address').style.display = 'none';
    document.getElementById('checkout-modal-review').style.display = 'block';
    document.getElementById('final-summary').innerHTML = `Send to: ${checkoutData.address.name}, ${checkoutData.address.city}`;
});

document.getElementById('buy-now-btn').addEventListener('click', async () => {
    const status = document.getElementById('api-status');
    status.textContent = "Verarbeite Bestellung...";
    
    const payload = {
        address: checkoutData.address,
        items: cart,
        total: document.getElementById('cart-total').textContent,
        shippingMethod: "standard"
    };

    try {
        const response = await fetch('https://website-keykicks.vercel.app/api/create-order', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        });
        const result = await response.json();
        if(result.success) {
            alert("Erfolg! Bestellnummer: " + result.orderId);
            cart = [];
            localStorage.clear();
            location.reload();
        } else {
            status.textContent = "Fehler: " + result.message;
        }
    } catch (e) {
        status.textContent = "Verbindungsfehler!";
    }
});

window.onload = () => { loadProducts(); renderCart(); };
</script>
</body>
</html>
